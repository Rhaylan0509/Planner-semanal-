<div class="group relative rounded-lg p-3 border shadow-sm transition-all duration-200 ease-in-out hover:shadow-lg hover:-translate-y-0.5"
      [class]="colorTheme().bg + ' ' + colorTheme().text + ' ' + colorTheme().border"
      [class.cursor-grab]="!viewMode()"
      [class.active:cursor-grabbing]="!viewMode()"
      [class.cursor-default]="viewMode()"
      [class.striped-background]="task().isBlock">
  
  <div class="flex items-start justify-between gap-2">
    <div class="flex-grow min-w-0" [class.opacity-60]="task().completed">
        <h3 class="font-semibold break-words" [class.line-through]="task().completed">{{ task().title }}</h3>

        @if(task().content) {
          <p class="text-sm mt-1 break-words opacity-80" [class.line-through]="task().completed">{{ task().content }}</p>
        }

        @if (task().tags?.length) {
          <div class="flex flex-wrap gap-1.5 mt-2.5">
            @for (tag of task().tags; track tag) {
              <span class="px-2 py-0.5 text-xs font-medium rounded-full" [class]="colorTheme().tagBg + ' ' + colorTheme().tagText">{{ tag }}</span>
            }
          </div>
        }
    </div>
    
    <div class="flex-shrink-0 flex items-center justify-center w-6 h-6 -mt-1 -mr-1">
      <div class="relative w-full h-full">
        @if (!viewMode()) {
          <!-- Buttons container, shown on hover -->
          <div class="absolute inset-0 flex items-center justify-end gap-0 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none group-hover:pointer-events-auto">
             <button (click)="onEdit($event)" [title]="'Editar ' + task().title" class="p-1 rounded-full hover:bg-black/10 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-current transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg>
             </button>
             <button (click)="onDelete($event)" [title]="'Excluir ' + task().title" class="p-1 rounded-full hover:bg-black/10 hover:text-red-500 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-current transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg>
             </button>
          </div>
          
          <!-- Checkbox, hidden on hover -->
          <div class="absolute inset-0 flex items-center justify-center opacity-100 group-hover:opacity-0 transition-opacity duration-200 pointer-events-none">
            <input type="checkbox" [checked]="task().completed" (change)="onToggleComplete($event)" (click)="$event.stopPropagation()"
                 class="form-checkbox h-5 w-5 rounded border-2 pointer-events-auto"
                 [class]="colorTheme().border"
                 [style.color]="colorTheme().dot"
                 [class.cursor-pointer]="!viewMode()">
          </div>
        } @else {
            <input type="checkbox" [checked]="task().completed" [disabled]="true"
                   class="form-checkbox h-5 w-5 rounded border-2 cursor-not-allowed"
                   [class]="colorTheme().border"
                   [style.color]="colorTheme().dot">
        }
      </div>
    </div>
  </div>
</div>